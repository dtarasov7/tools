sockperf. –ù–∞ –æ–¥–Ω–æ–π –Ω–æ–¥–µ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä: sockperf sr -i IP --tcp. –ù–∞ –¥—Ä—É–≥–æ–π –∫–ª–∏–µ–Ω—Ç –≤ —Ä–µ–∂–∏–º–µ ping-pong: 
sockperf pp -i SERVER_IP --tcp -m 4096. 
–í–ù–ò–ú–ê–ù–ò–ï: –í –≤—ã–≤–æ–¥–µ —Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–æ–≤–∏–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ (–∑–∞–¥–µ—Ä–∂–∫–∞ –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É). 
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è RTT –µ—ë —Å—Ç–æ–∏—Ç —É–º–Ω–æ–∂–∏—Ç—å –Ω–∞ 2.
 –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ä–µ–¥–Ω–∏–π RTT - –≤ —Ä–∞–π–æ–Ω–µ 30-50 –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥ (0.05ms).


–ü–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à –∑–∞–ø–∏—Å–∏ –¥–∏—Å–∫–∞: hdparm -W 0 /dev/sdX (SATA-–¥–∏—Å–∫–∏ —á–µ—Ä–µ–∑ SATA –∏–ª–∏ HBA), sdparm --set WCE=0 /dev/sdX (SAS-–¥–∏—Å–∫–∏). –ù–µ —Å–æ–≤—Å–µ–º —è—Å–Ω–æ, –ø–æ—á–µ–º—É, –Ω–æ —ç—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö SSD –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å IOPS-—ã –Ω–∞ 2 –ø–æ—Ä—è–¥–∫–∞ (–∞ –º–æ–∂–µ—Ç –ù–ï —É–≤–µ–ª–∏—á–∏—Ç—å, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–±—É–π—Ç–µ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ ‚Äî –∏ W0, –∏ W1). –¢–∞–∫–∂–µ —Å–º.–Ω–∏–∂–µ #–ö–∞—Ä—Ç–∏–Ω–∞ –º–∞—Å–ª–æ–º ¬´–¢–æ—Ä–º–æ–∑—è—â–∏–π –∫—ç—à¬ª.
–õ–∏–Ω–µ–π–Ω–æ–µ —á—Ç–µ–Ω–∏–µ: fio -ioengine=libaio -direct=1 -invalidate=1 -name=test -bs=4M -iodepth=32 -rw=read -runtime=60 -filename=/dev/sdX
–õ–∏–Ω–µ–π–Ω–∞—è –∑–∞–ø–∏—Å—å: fio -ioengine=libaio -direct=1 -invalidate=1 -name=test -bs=4M -iodepth=32 -rw=write -runtime=60 -filename=/dev/sdX
–ü–∏–∫–æ–≤—ã–µ IOPS —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è: fio -ioengine=libaio -direct=1 -invalidate=1 -name=test -bs=4k -iodepth=128 -rw=randread -runtime=60 -filename=/dev/sdX
–ó–∞–¥–µ—Ä–∂–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è: fio -ioengine=libaio -sync=1 -direct=1 -invalidate=1 -name=test -bs=4k -iodepth=1 -rw=randread -runtime=60 -filename=/dev/sdX
–ü–∏–∫–æ–≤—ã–µ IOPS —Å–ª—É—á–∞–π–Ω–æ–π –∑–∞–ø–∏—Å–∏: fio -ioengine=libaio -direct=1 -invalidate=1 -name=test -bs=4k -iodepth=128 -rw=randwrite -runtime=60 -filename=/dev/sdX
–ó–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –∂—É—Ä–Ω–∞–ª: fio -ioengine=libaio -sync=1 -direct=1 -invalidate=1 -name=test -bs=4k -iodepth=1 -rw=write -runtime=60 -filename=/dev/sdX ‚Äî —Ç–∞–∫–∂–µ —Å—Ç–æ–∏—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–æ—Ç –∂–µ —Ç–µ—Å—Ç —Å -fsync=1 –≤–º–µ—Å—Ç–æ -sync=1 –∏ –ø—Ä–∏–Ω—è—Ç—å —Ö—É–¥—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ç–∞–∫ –∫–∞–∫ –∏–Ω–æ–≥–¥–∞ –±—ã–≤–∞–µ—Ç, —á—Ç–æ –æ–¥–Ω–∏–º –∏–∑ –º–µ—Ç–æ–¥–æ–≤ sync –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞).
–ó–∞–¥–µ—Ä–∂–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–π –∑–∞–ø–∏—Å–∏: fio -ioengine=libaio -sync=1 -direct=1 -invalidate=1 -name=test -bs=4k -iodepth=1 -rw=randwrite -runtime=60 -filename=/dev/sdX


### **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏—Å–∫–æ–≤ –Ω–∞ MON-—Å–µ—Ä–≤–µ—Ä–∞—Ö Ceph?**  

–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏—Å–∫–æ–≤ –Ω–∞ MON (Monitor) —Å–µ—Ä–≤–µ—Ä–∞—Ö ‚Äî **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä** –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞. MON —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–Ω—Å–µ–Ω—Å—É—Å, –∏—Å–ø–æ–ª—å–∑—É—è **RocksDB**, –∫–æ—Ç–æ—Ä–∞—è —Å–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç **IOPS –∏ latencies –¥–∏—Å–∫–∞**.  

---

## **üîç 1. –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ ceph status**  
–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å, –Ω–µ—Ç –ª–∏ –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é MON:  
```bash
ceph status
```
üîπ –ï—Å–ª–∏ –≤–∏–¥–∏—à—å **"MON_DISK_WRITES_TOO_SLOW"** –∏–ª–∏ **"MON_CLIENT_LATENCY_TOO_HIGH"** ‚Üí —ç—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã–π –¥–∏—Å–∫ MON.  

–ú–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ (latency) –º–æ–Ω–∏—Ç–æ—Ä–æ–≤:  
```bash
ceph mon dump
```
üîπ –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ **`store_latency_ms`** ‚Äî –µ—Å–ª–∏ –æ–Ω –≤—ã—à–µ 10-20 –º—Å, –¥–∏—Å–∫ MON —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ.

---

## **üìä 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã RocksDB –Ω–∞ MON —á–µ—Ä–µ–∑ ceph daemon**  
Ceph –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É RocksDB –Ω–∞ MON:  
```bash
ceph daemon mon.<mon_name> perf dump | jq '.rocksdb'
```
üîπ –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:  
- **`rocksdb.get.micros`** ‚Äì —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ –≤ ¬µs (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 100)  
- **`rocksdb.write.micros`** ‚Äì –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –≤ ¬µs (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 500)  
- **`rocksdb.sst.read.micros`** ‚Äì —Å–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è (—á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –ª—É—á—à–µ)  

üëâ **–ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤—ã—à–µ, —á–µ–º —É–∫–∞–∑–∞–Ω–æ ‚Äî –¥–∏—Å–∫–∏ –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è!**  

---

## **üöÄ 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–∏—Å–∫–æ–≤ MON (RocksDB)**
### **üìå 3.1. FIO-—Ç–µ—Å—Ç –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è IOPS –∏ latencies**
–ü–æ—Å–∫–æ–ª—å–∫—É MON –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–Ω–æ–≥–æ –º–∞–ª–µ–Ω—å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π** (4 KB), –≤–∞–∂–Ω—ã:  
- **–ß–∞—Å—Ç–æ—Ç–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** (IOPS)  
- **–ó–∞–¥–µ—Ä–∂–∫–∏ –∑–∞–ø–∏—Å–∏ (latency)**  

**–¢–µ—Å—Ç –¥–∏—Å–∫–∞ FIO –≤ —Ä–µ–∂–∏–º–µ RocksDB:**  
```bash
fio --name=test --filename=/var/lib/ceph/mon/ceph-<mon-name>/test.fio \
 --rw=randwrite --bs=4k --ioengine=libaio --iodepth=16 --numjobs=4 \
 --direct=1 --runtime=60 --time_based --group_reporting
```
üëâ **–û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è —Ö–æ—Ä–æ—à–µ–≥–æ MON-–¥–∏—Å–∫–∞ (SSD, NVMe):**  
- **IOPS:** > 10 000  
- **Latency:** < 1 –º—Å  

‚ö†Ô∏è **–ï—Å–ª–∏ IOPS < 5000 –∏ latency > 2 –º—Å** ‚Üí MON-—Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä.

---

## **üîÑ 4. –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏ –≤ RocksDB (Ceph Benchmark)**
–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É RocksDB:  
```bash
ceph tell mon.* bench
```
üîπ **–í—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º:**  
```
{ "bytes_written": 40960000, "seconds": 1.234, "bytes_per_sec": 33200000 }
```
üëâ –ï—Å–ª–∏ **bytes_per_sec < 20 MB/s** ‚Üí –¥–∏—Å–∫ —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–π.  

---

## **üìà 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Grafana / Prometheus**
Ceph –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **MON-–º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus**. –í Grafana –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å:  
- **`ceph_mon_store_latency_seconds`** ‚Üí –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–∏—Å–∫–∞  
- **`ceph_mon_num_sessions`** ‚Üí –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤  
- **`ceph_mon_quorum_size`** ‚Üí —Ä–∞–∑–º–µ—Ä –∫–≤–æ—Ä—É–º–∞  

–ï—Å–ª–∏ latency **> 10 –º—Å**, –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–∏—Å–∫–æ–º MON.

---

## **üìå –í—ã–≤–æ–¥**
1Ô∏è‚É£ **–ó–∞–ø—É—Å—Ç–∏** `ceph status`, `ceph daemon mon.* perf dump` ‚Üí –ø—Ä–æ–≤–µ—Ä—å latency MON.  
2Ô∏è‚É£ **–ü—Ä–æ–≥–æ–Ω–∏ fio-—Ç–µ—Å—Ç** –Ω–∞ –¥–∏—Å–∫–∞—Ö MON (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–µ SSD/NVMe).  
3Ô∏è‚É£ **–ò—Å–ø–æ–ª—å–∑—É–π Grafana** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–∞–¥–µ—Ä–∂–µ–∫ RocksDB.  
4Ô∏è‚É£ **–ï—Å–ª–∏ –∑–∞–¥–µ—Ä–∂–∫–∏ –±–æ–ª—å—à–∏–µ (–±–æ–ª–µ–µ 10 –º—Å), –ø–æ–¥—É–º–∞–π –æ –∑–∞–º–µ–Ω–µ –¥–∏—Å–∫–∞** –Ω–∞ **NVMe –∏–ª–∏ –±—ã—Å—Ç—Ä—ã–π SSD**.  

üëâ –ï—Å–ª–∏ –Ω—É–∂–Ω–æ **–ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ ‚Äî –ø–∏—à–∏! üòä**

