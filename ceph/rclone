### **–ö–∞–∫ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ S3 (Ceph RADOS Gateway) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `rclone`?**  

–í Ceph 17.2.7 —É –≤–∞—Å —Ç—Ä–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ RADOS Gateway (RGW), –∏ **`rclone`** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏, –µ—Å–ª–∏ –≤—Å–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã RGW –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π S3-—ç–Ω–¥–ø–æ–∏–Ω—Ç. –û–¥–Ω–∞–∫–æ –º–æ–∂–Ω–æ **—è–≤–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏** –º–µ–∂–¥—É –≤—Å–µ–º–∏ —Ç—Ä–µ–º—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

---

## **1. –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏**
–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –∑–∞—Å—Ç–∞–≤–∏—Ç—å `rclone` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–∏ RGW-—Å–µ—Ä–≤–µ—Ä–∞:

### **‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ (HAProxy, Nginx, LVS)**
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?**  
  –í—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, HAProxy –∏–ª–∏ Nginx), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É –≤—Å–µ–º–∏ —Ç—Ä–µ–º—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ RGW.
- **–õ—É—á—à–∏–π —Å–ø–æ—Å–æ–± –ø—Ä–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ S3-—ç–Ω–¥–ø–æ–∏–Ω—Ç.**

#### **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ HAProxy (–ø—Ä–∏–º–µ—Ä)**
```cfg
frontend s3_front
    bind *:9000
    default_backend s3_back

backend s3_back
    balance roundrobin
    server rgw1 10.1.1.10:80 check
    server rgw2 10.1.1.11:80 check
    server rgw3 10.1.1.12:80 check
```
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ **`rclone`** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç –Ω–∞–≥—Ä—É–∑–∫—É –º–µ–∂–¥—É –≤—Å–µ–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ RGW:
```bash
rclone sync s3:mybucket /backup --progress --transfers=16 --s3-concurrency=16
```

---

### **‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `rclone` —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏**
–ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–µ—Ç, –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É–∫–∞–∑–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã RGW.

1. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ `rclone.conf`**:  
–§–∞–π–ª `~/.config/rclone/rclone.conf`:
```ini
[ceph-rgw-1]
type = s3
provider = Ceph
access_key_id = YOUR_ACCESS_KEY
secret_access_key = YOUR_SECRET_KEY
endpoint = http://10.1.1.10:80

[ceph-rgw-2]
type = s3
provider = Ceph
access_key_id = YOUR_ACCESS_KEY
secret_access_key = YOUR_SECRET_KEY
endpoint = http://10.1.1.11:80

[ceph-rgw-3]
type = s3
provider = Ceph
access_key_id = YOUR_ACCESS_KEY
secret_access_key = YOUR_SECRET_KEY
endpoint = http://10.1.1.12:80
```
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç—Ä–∏ `rclone`-–ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**:
```bash
rclone sync ceph-rgw-1:mybucket /backup1 --transfers=8 --s3-concurrency=8 --progress &
rclone sync ceph-rgw-2:mybucket /backup2 --transfers=8 --s3-concurrency=8 --progress &
rclone sync ceph-rgw-3:mybucket /backup3 --transfers=8 --s3-concurrency=8 --progress &
wait
```
**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**
- –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å `rclone` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä RGW.
- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤ `/backup1`, `/backup2` –∏ `/backup3`.
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è).

---

### **‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 3: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞–º S3**
–ï—Å–ª–∏ –≤–∞—à –±–∞–∫–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç **–º–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤**, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å `rclone` –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—É—Ç—è–º–∏ (S3-–ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏):

1. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏) –≤ –±–∞–∫–µ—Ç–µ:**
   ```bash
   rclone lsd s3:mybucket
   ```
2. **–†–∞–∑–¥–µ–ª–∏—Ç–µ —Ä–∞–±–æ—Ç—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**
   ```bash
   rclone sync s3:mybucket/folder1 /backup1 --progress --transfers=8 --s3-concurrency=8 &
   rclone sync s3:mybucket/folder2 /backup2 --progress --transfers=8 --s3-concurrency=8 &
   rclone sync s3:mybucket/folder3 /backup3 --progress --transfers=8 --s3-concurrency=8 &
   wait
   ```
3. –≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç **–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤**, –∑–∞–≥—Ä—É–∂–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç–µ–π –±–∞–∫–µ—Ç–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

---

### **‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `rclone mount` –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è**
–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞–¥–æ –ø—Ä–æ—Å—Ç–æ **—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –¥–∏—Å–∫**, –º–æ–∂–Ω–æ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∫–µ—Ç –∫–∞–∫ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –æ–±—ã—á–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ Linux.

1. **–ú–æ–Ω—Ç–∏—Ä—É–µ–º S3-–±–∞–∫–µ—Ç:**
   ```bash
   rclone mount s3:mybucket /mnt/s3 --daemon
   ```
2. **–ò—Å–ø–æ–ª—å–∑—É–µ–º `rsync` –∏–ª–∏ `cp` –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ:**
   ```bash
   rsync -av --progress /mnt/s3/ /backup/
   ```

**–ü–ª—é—Å—ã:**
- –õ–µ–≥—á–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤.
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `xargs -P` –∏–ª–∏ `parallel` –¥–ª—è —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏—è.

---

## **6. –í—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞**
| **–ú–µ—Ç–æ–¥**                        | **–°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** |
|----------------------------------|----------------------------|
| **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ (HAProxy, Nginx)** | –õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ |
| **–ù–µ—Å–∫–æ–ª—å–∫–æ `rclone` –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ RGW** | –•–æ—Ä–æ—à–æ, –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–µ—Ç |
| **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞–º S3** | –ü–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ –≤ –±–∞–∫–µ—Ç–µ –º–Ω–æ–≥–æ –ø–∞–ø–æ–∫ |
| **`rclone mount` + `rsync`** | –£–¥–æ–±–Ω–æ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã |

–ï—Å–ª–∏ —É –≤–∞—Å **—É–∂–µ –µ—Å—Ç—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫**, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–í–∞—Ä–∏–∞–Ω—Ç 1**.  
–ï—Å–ª–∏ –µ–≥–æ **–Ω–µ—Ç**, –Ω–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ `rclone` –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ ‚Äî **–í–∞—Ä–∏–∞–Ω—Ç 2**.  

---

### **–í—ã–≤–æ–¥**
–î–∞, –º–æ–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å `rclone` –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ S3 (Ceph RGW), —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—è –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤—Å–µ —Ç—Ä–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞. –õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏**. –ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ `rclone` —Å —Ä–∞–∑–Ω—ã–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏** –∏–ª–∏ **—Ä–∞–∑–¥–µ–ª–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø–æ S3-–ø—Ä–µ—Ñ–∏–∫—Å–∞–º**.

–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–ª–∏ –ø–æ–º–æ—â—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ ‚Äî —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ! üòäüöÄ
