ceph 17.2
ansible 2.12
–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π . –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
Project:
  project1:
    name: "nameproject1"
    placement: placementproject1
    admin: 
      name: xadmin
      secret_key: "xxx"
      access_key: "yyy"
    backets:
      bucket1:
        name: namebucket1
      bucket2:
        name: namebucket2
    users:
      user1:
        name: nameuser1
        policies:
          policy1:
            name: policyname
            sid: #—Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å policy1.name
            effect: allow
            action:
              - add
              - del
            resorce: 
              - "arn:::b1"
              - "arn:::b1/*"

–ù–∞–ø–∏—à–∏ –∫–æ–¥ –Ω–∞ ansible, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ buckets , –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π(users) –∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–ª–∏—Ç–∏–∫–∏.
–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–∏–≤—è–∑–∫–∞ –∏—Ö –∫ placement - —á–µ—Ä–µ–∑ radosgw-admin .
C–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–æ–≤ –∏ –ø—Ä–∏–≤—è–∑–∫–∞ –ø–æ–ª–∏—Ç–∏–∫ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ aws (v1) c –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞ —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ ( –æ–Ω –∏–º–µ–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞).


ChatGPT —Å–∫–∞–∑–∞–ª:
–í–æ—Ç –∫–æ–¥ Ansible, –∫–æ—Ç–æ—Ä—ã–π:
‚úÖ –°–æ–∑–¥–∞—ë—Ç –±–∞–∫–µ—Ç—ã —á–µ—Ä–µ–∑ AWS CLI —Å —É—á—ë—Ç–æ–º —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞.
‚úÖ –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ radosgw-admin.
‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–ª–∏—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ AWS CLI.

–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –∫–æ–¥–∞
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥—É–ª—å ansible.builtin.shell, —Ç–∞–∫ –∫–∞–∫ radosgw-admin –∏ aws —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ CLI.

–õ–æ–≥–∏–∫–∞ —Ä–∞–∑–±–∏—Ç–∞ –ø–æ —à–∞–≥–∞–º: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –±–∞–∫–µ—Ç–æ–≤ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫.

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π Project.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ with_dict –∏ with_items, —á—Ç–æ–±—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–µ–∫—Ç–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–∞–∫–µ—Ç–æ–≤.

Ansible Playbook
yaml
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- name: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ceph S3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–∞–∫–µ—Ç–æ–≤
  hosts: localhost
  gather_facts: no
  vars:
    Project:
      project1:
        name: "nameproject1"
        placement: placementproject1
        admin: 
          name: xadmin
          secret_key: "xxx"
          access_key: "yyy"
        buckets:
          bucket1:
            name: namebucket1
          bucket2:
            name: namebucket2
        users:
          user1:
            name: nameuser1
            policies:
              policy1:
                name: policyname
                sid: policyname  # —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å policy1.name
                effect: allow
                action:
                  - add
                  - del
                resource: 
                  - "arn:::b1"
                  - "arn:::b1/*"

  tasks:
    - name: "–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Ceph"
      ansible.builtin.shell: |
        radosgw-admin user create --uid={{ item.value.name }} \
          --display-name="{{ item.value.name }}" \
          --placement-id={{ Project[item.key].placement }}
      with_dict: "{{ Project.project1.users }}"
      register: user_creation
      changed_when: "'user_info' in user_creation.stdout"

    - name: "–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ AWS S3 CLI"
      ansible.builtin.shell: |
        AWS_ACCESS_KEY_ID={{ Project.project1.admin.access_key }} \
        AWS_SECRET_ACCESS_KEY={{ Project.project1.admin.secret_key }} \
        aws --endpoint-url http://ceph-s3.example.com s3api create-bucket --bucket {{ item.value.name }}
      with_dict: "{{ Project.project1.buckets }}"
      register: bucket_creation
      changed_when: "'Bucket' in bucket_creation.stdout"

    - name: "–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º"
      ansible.builtin.shell: |
        cat > /tmp/policy_{{ item.0.value.name }}.json <<EOF
        {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "{{ item.1.value.sid }}",
              "Effect": "{{ item.1.value.effect | capitalize }}",
              "Action": {{ item.1.value.action | to_json }},
              "Resource": {{ item.1.value.resource | to_json }}
            }
          ]
        }
        EOF
        AWS_ACCESS_KEY_ID={{ Project.project1.admin.access_key }} \
        AWS_SECRET_ACCESS_KEY={{ Project.project1.admin.secret_key }} \
        aws --endpoint-url http://ceph-s3.example.com s3api put-bucket-policy \
          --bucket {{ Project.project1.buckets.bucket1.name }} \
          --policy file:///tmp/policy_{{ item.0.value.name }}.json
      with_subelements:
        - "{{ Project.project1.users }}"
        - policies
      register: policy_assignment
      changed_when: "'Policy' in policy_assignment.stdout"
–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–æ—Ç Playbook?
üîπ –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Ceph —á–µ—Ä–µ–∑ radosgw-admin.
üîπ –°–æ–∑–¥–∞—ë—Ç –±–∞–∫–µ—Ç—ã —á–µ—Ä–µ–∑ AWS CLI, –∏—Å–ø–æ–ª—å–∑—É—è —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞.
üîπ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JSON-—Ñ–∞–π–ª –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –µ–≥–æ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ AWS S3 API.

–≠—Ç–æ—Ç –∫–æ–¥ –≥–∏–±–∫–∏–π –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –±–∞–∫–µ—Ç–∞–º–∏. üöÄ







–í—ã —Å–∫–∞–∑–∞–ª–∏:
–≤ –∑–¥–µ—Å—å 
aws --endpoint-url http://ceph-s3.example.com s3api put-bucket-policy \
          --bucket {{ Project.project1.buckets.bucket1.name }} \
          --policy file:///tmp/policy_{{ item.0.value.name }}.json
–∏—Å–ø–æ–ª—å–∑—É–π iam –∞ –Ω–µ s3api. –ò –Ω–∞–¥–æ —É–∫–∞–∑–∞—Ç—å uid –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–∏—Ç–∏–∫–∞

–∫—Ä–æ–º–µ —Ç–æ–≥–æ –¥–æ–±–∞–≤—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é caps, –∑–∞–¥–∞–≤–∞–µ–º–æ–≥–æ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    users:
      user1:
        name: nameuser1
        caps: "zone:*;user:*"
        policies:
–î–æ–±–∞–≤—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–≥–æ . —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–¥–æ:
- –∏–∑–º–µ–Ω–∏—Ç—å –∏–º–µ—é—â–∏–µ—Å—è caps –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å aps
- —É–¥–∞–ª–∏—Ç—å –∏–º–µ—é—â–∏–µ—Å—è –ø–æ–ª–∏—Ç–∏–∫–∏ (aws iam) –Ω–µ –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π projects
- –ò–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏
- –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø–∏—Å–∞–Ω –≤ Projects, –Ω–æ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Ç–æ –µ–≥–æ –Ω–∞–¥–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø–∞—É–∑—É.



ChatGPT —Å–∫–∞–∑–∞–ª:
–í–æ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π Ansible Playbook, –∫–æ—Ç–æ—Ä—ã–π:
‚úÖ –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–∞–∫–µ—Ç—ã (–µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç).
‚úÖ –ò–∑–º–µ–Ω—è–µ—Ç caps —É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è).
‚úÖ –£–¥–∞–ª—è–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ.
‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ AWS IAM, –∞ –Ω–µ s3api.
‚úÖ –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç (suspended: true) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç –≤ Project, –Ω–æ –æ–Ω–∏ –µ—Å—Ç—å –≤ Ceph.

Ansible Playbook
yaml
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- name: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ceph S3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–∞–∫–µ—Ç–æ–≤
  hosts: localhost
  gather_facts: no
  vars:
    ceph_endpoint: "http://ceph-s3.example.com"
    Project:
      project1:
        name: "nameproject1"
        placement: placementproject1
        admin: 
          name: xadmin
          secret_key: "xxx"
          access_key: "yyy"
        buckets:
          bucket1:
            name: namebucket1
          bucket2:
            name: namebucket2
        users:
          user1:
            name: nameuser1
            caps: "zone:*;user:*"
            policies:
              policy1:
                name: policyname
                sid: policyname
                effect: allow
                action:
                  - add
                  - del
                resource: 
                  - "arn:::b1"
                  - "arn:::b1/*"

  tasks:

    # --- –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Ceph ---
    - name: –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      ansible.builtin.shell: radosgw-admin user list | jq -r '.[]'
      register: existing_users
      changed_when: false

    - name: –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      ansible.builtin.set_fact:
        existing_users_list: "{{ existing_users.stdout_lines }}"

    # --- –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ---
    - name: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Å–æ–∑–¥–∞—ë–º/–æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      ansible.builtin.shell: |
        radosgw-admin user info --uid={{ item.value.name }} 2>/dev/null || echo "USER_NOT_FOUND"
      register: user_info
      changed_when: false
      with_dict: "{{ Project.project1.users }}"

    - name: "–°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Ceph"
      ansible.builtin.shell: |
        radosgw-admin user create --uid={{ item.value.name }} \
          --display-name="{{ item.value.name }}" \
          --placement-id={{ Project.project1.placement }} \
          --caps="{{ item.value.caps }}"
      when: "'USER_NOT_FOUND' in item.1.stdout"
      with_dict: "{{ Project.project1.users }}"
      register: user_creation

    - name: "–û–±–Ω–æ–≤–ª—è–µ–º caps —É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
      ansible.builtin.shell: |
        radosgw-admin user modify --uid={{ item.value.name }} --caps="{{ item.value.caps }}"
      when: "'USER_NOT_FOUND' not in item.1.stdout"
      with_dict: "{{ Project.project1.users }}"
      register: user_caps_update
      changed_when: "'caps' in user_caps_update.stdout"

    # --- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–æ–≤ ---
    - name: "–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ AWS S3 CLI"
      ansible.builtin.shell: |
        AWS_ACCESS_KEY_ID={{ Project.project1.admin.access_key }} \
        AWS_SECRET_ACCESS_KEY={{ Project.project1.admin.secret_key }} \
        aws --endpoint-url {{ ceph_endpoint }} s3api create-bucket --bucket {{ item.value.name }}
      with_dict: "{{ Project.project1.buckets }}"
      register: bucket_creation
      changed_when: "'Bucket' in bucket_creation.stdout"

    # --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ---
    - name: "–ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
      ansible.builtin.shell: |
        AWS_ACCESS_KEY_ID={{ Project.project1.admin.access_key }} \
        AWS_SECRET_ACCESS_KEY={{ Project.project1.admin.secret_key }} \
        aws --endpoint-url {{ ceph_endpoint }} iam list-user-policies --user-name {{ item.value.name }} | jq -r '.PolicyNames[]'
      register: current_policies
      with_dict: "{{ Project.project1.users }}"
      changed_when: false

    - name: "–£–¥–∞–ª—è–µ–º –ø–æ–ª–∏—Ç–∏–∫–∏, –Ω–µ –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ Project"
      ansible.builtin.shell: |
        AWS_ACCESS_KEY_ID={{ Project.project1.admin.access_key }} \
        AWS_SECRET_ACCESS_KEY={{ Project.project1.admin.secret_key }} \
        aws --endpoint-url {{ ceph_endpoint }} iam delete-user-policy \
          --user-name {{ item.0.value.name }} --policy-name {{ item.1 }}
      when: item.1 not in item.0.value.policies.keys()
      with_subelements:
        - "{{ Project.project1.users }}"
        - current_policies.stdout_lines

    - name: "–ù–∞–∑–Ω–∞—á–∞–µ–º –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ AWS IAM"
      ansible.builtin.shell: |
        cat > /tmp/policy_{{ item.0.value.name }}.json <<EOF
        {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "{{ item.1.value.sid }}",
              "Effect": "{{ item.1.value.effect | capitalize }}",
              "Action": {{ item.1.value.action | to_json }},
              "Resource": {{ item.1.value.resource | to_json }}
            }
          ]
        }
        EOF
        AWS_ACCESS_KEY_ID={{ Project.project1.admin.access_key }} \
        AWS_SECRET_ACCESS_KEY={{ Project.project1.admin.secret_key }} \
        aws --endpoint-url {{ ceph_endpoint }} iam put-user-policy \
          --user-name {{ item.0.value.name }} \
          --policy-name {{ item.1.value.name }} \
          --policy-document file:///tmp/policy_{{ item.0.value.name }}.json
      with_subelements:
        - "{{ Project.project1.users }}"
        - policies
      register: policy_assignment
      changed_when: "'Policy' in policy_assignment.stdout"

    # --- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ Project ---
    - name: "–ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ Project"
      ansible.builtin.shell: |
        radosgw-admin user suspend --uid={{ item }}
      when: item not in Project.project1.users.keys()
      with_items: "{{ existing_users_list }}"
üî• –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ?
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å ‚Üí –æ–±–Ω–æ–≤–ª—è–µ–º caps, —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏.

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞—ë–º –µ–≥–æ.

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª, –Ω–æ —É–¥–∞–ª—ë–Ω –∏–∑ Project ‚Üí —Å—Ç–∞–≤–∏–º –µ–≥–æ –Ω–∞ –ø–∞—É–∑—É (suspend).

‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AWS IAM API –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫, –∞ –Ω–µ s3api put-bucket-policy.

‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ caps –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–∏—Ç–∏–∫, –Ω–µ –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ Project.

‚úÖ –í—ã–≤–æ–¥–∏—Ç, —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç register –∏ changed_when.

üî• –¢–µ–ø–µ—Ä—å —ç—Ç–æ—Ç Ansible Playbook –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å! üöÄ
