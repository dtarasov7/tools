–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –≤ –∫–æ–¥ —Ç–∞–∫ , —á—Ç–æ–±—ã –º–µ–∂–¥—É –∫–∞–∂–¥—ã–º —á—Ç–µ–Ω–∏–µ–º, –∫–∞–∂–¥—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏ –∫–∞–∂–¥—ã–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤—ã–¥–µ—Ä–∂–∏–≤–∞–ª–∞—Å—å –ø–∞—É–∑–∞, —Ç–∞–∫–∞—è, —á—Ç–æ–±—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –∫–∞–∂–¥–æ–º –ø–æ—Ç–æ–∫–µ –∑–∞–≤–µ—Ä—à–∞–ª–∏—Å—å –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ –æ–¥–Ω–æ –∏ —Ç–æ–∂–µ –≤—Ä–µ–º—è. –í –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ —ç—Ç–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–∞–≤–Ω–∞ –Ω—É–ª—é, –∞ –≤ —Å–ª–µ–¥—É—â–µ–π –æ–Ω–∏ –≤—ã—Å—á–∏—Ç—ã–≤–∞–ª–∞—Å—å –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ç–∞–∏—Å—Ç–∏–∫–∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏.
–ü—Ä–∏–º–µ—Ä (—Ü–∏—Ñ—Ä—ã —Å–ª—É—á–∞–π–Ω—ã–µ).
–≤ –æ–¥–Ω–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏:
-  100 —á—Ç–µ–Ω–∏–π , –∫–∞–∂–¥–æ–µ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –¥–ª–∏—Ç—Å—è 1 —Å–µ–∫
- 10 –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∂–¥–æ–µ –¥–ª–∏—Ç—Å—è 6 —Å–µ–∫
- 5 –¥–æ–±–∞–≤–ª–µ–Ω–∏–π, –∫–∞–∂–¥–æ–µ –¥–ª–∏—Ç—å—Å—è 8 —Å–µ–∫—É–Ω–¥
–í —ç—Ç–æ —Å–ª—É—á–∞–µ –º–µ–∂–¥—É —á—Ç–µ–Ω–∏—è–º–∏ –Ω–µ—Ç –ø–∞—É–∑, –º–µ–∂–¥—É –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –ø–∞—É–∑–∞ 4 —Å–µ–∫—É–Ω–¥—ã, –º–µ–∂–¥—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è–º–∏ –ø–∞—É–∑–∞ 12 —Å–µ–∫—É–Ω–¥. –¢–æ–≥–¥–∞ 100 —á—Ç–µ–Ω–∏–π –±—É–¥–µ—Ç –¥–ª–∏—Ç—å—Å—è 100 —Å–µ–∫—É–Ω–¥. 10 –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –ø–∞—É–∑–∞–º–∏ –±—É–¥–µ—Ç –¥–ª–∏—Ç—å—Å—è —Ç–æ–∂–µ 100 —Å–µ–∫—É–Ω–¥. –ò 5 –¥–æ–±–∞–≤–ª–µ–Ω–∏–π —Å –ø–∞—É–∑–∞–º–∏ –±—É–¥–µ—Ç –¥–ª–∏—Ç—å—Å—è —Ç–æ–∂–µ 100 —Å–µ–∫—É–Ω–¥.


ChatGPT —Å–∫–∞–∑–∞–ª:
–í–æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–∞—É–∑–æ–π –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏, —á—Ç–æ–±—ã –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –∑–∞–≤–µ—Ä—à–∞–ª–∏—Å—å –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

–û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–∞—É–∑—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏.
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤, —á—Ç–æ–±—ã –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—á—Ç–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—å, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ) –∑–∞–≤–µ—Ä—à–∞–ª–∏—Å—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
‚úÖ –ü–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –ø–∞—É–∑, –Ω–æ —Å–æ –≤—Ç–æ—Ä–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø–∞—É–∑—ã –≤—ã—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –ø–∞—É–∑—ã?
–í –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Ç –ø–∞—É–∑, –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π.

–í —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø–∞—É–∑—ã:

–ë–µ—Ä–µ—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ —Ç–∞–∫, —á—Ç–æ–±—ã —Å–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–ø—Ä–µ–¥–µ–ª—è–ª –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —á—Ç–µ–Ω–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç 1 —Å–µ–∫, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 6 —Å–µ–∫, –∞ –∑–∞–ø–∏—Å—å 8 —Å–µ–∫, —Ç–æ –ø–∞—É–∑—ã –±—É–¥—É—Ç:

–ß—Ç–µ–Ω–∏—è: 0 —Å–µ–∫

–û–±–Ω–æ–≤–ª–µ–Ω–∏—è: 4 —Å–µ–∫

–ó–∞–ø–∏—Å–∏: 12 —Å–µ–∫

–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:
python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
import boto3
import os
import random
import time
import sys
import threading
import signal
import termios
import tty
import argparse
from botocore.exceptions import BotoCoreError, ClientError

stop_flag = False  # –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è –≤—ã—Ö–æ–¥–∞

def signal_handler(sig, frame):
    global stop_flag
    stop_flag = True
    print("\n–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...")

signal.signal(signal.SIGINT, signal_handler)  # –ü–µ—Ä–µ—Ö–≤–∞—Ç Ctrl-C

def safe_call(func, *args, **kwargs):
    try:
        return func(*args, **kwargs)
    except (BotoCoreError, ClientError) as e:
        return e

def key_listener():
    global stop_flag
    fd = sys.stdin.fileno()
    old_settings = termios.tcgetattr(fd)
    try:
        tty.setcbreak(fd)
        while not stop_flag:
            ch = sys.stdin.read(1)
            if ch.lower() in ["q", "–π"]:
                stop_flag = True
                print("\n–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...")
                break
    finally:
        termios.tcsetattr(fd, termios.TCSADRAIN, old_settings)

def s3_test(bucket_name, num_init_objects, object_size, num_read, num_write, num_update):
    global stop_flag

    s3 = boto3.client(
        "s3",
        endpoint_url="http://ceph-rgw.example.com",
        aws_access_key_id="your-access-key",
        aws_secret_access_key="your-secret-key"
    )

    response = safe_call(s3.create_bucket, Bucket=bucket_name)
    if isinstance(response, ClientError) and response.response['Error']['Code'] == 'BucketAlreadyOwnedByYou':
        print(f"–ë–∞–∫–µ—Ç {bucket_name} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.")
    elif isinstance(response, ClientError):
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–∞–∫–µ—Ç–∞: {response}")
        return

    object_keys = []
    iteration = 0
    read_times, write_times, update_times = [], [], []
    read_pause, write_pause, update_pause = 0, 0, 0  

    print(f"–ó–∞–ø–æ–ª–Ω—è–µ–º –±–∞–∫–µ—Ç {bucket_name} {num_init_objects} –æ–±—ä–µ–∫—Ç–∞–º–∏...")
    for i in range(num_init_objects):
        key = f"init-object-{i}"
        object_keys.append(key)
        data = os.urandom(object_size)
        safe_call(s3.put_object, Bucket=bucket_name, Key=key, Body=data)

    print("–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.")

    key_thread = threading.Thread(target=key_listener, daemon=True)
    key_thread.start()

    while not stop_flag:
        iteration += 1
        print(f"\n=== –ò—Ç–µ—Ä–∞—Ü–∏—è {iteration} ===")

        current_read_times, current_write_times, current_update_times = [], [], []

        def write_objects():
            for i in range(num_write):
                key = f"object-{iteration}-{i}"
                object_keys.append(key)
                data = os.urandom(object_size)
                start_time = time.time()
                safe_call(s3.put_object, Bucket=bucket_name, Key=key, Body=data)
                current_write_times.append(time.time() - start_time)
                if i < num_write - 1:
                    time.sleep(write_pause)

        def read_objects():
            for i, key in enumerate(random.sample(object_keys, min(num_read, len(object_keys)))):
                start_time = time.time()
                safe_call(s3.get_object, Bucket=bucket_name, Key=key)
                current_read_times.append(time.time() - start_time)
                if i < num_read - 1:
                    time.sleep(read_pause)

        def update_objects():
            for i, key in enumerate(random.sample(object_keys, min(num_update, len(object_keys)))):
                data = os.urandom(object_size)
                start_time = time.time()
                safe_call(s3.put_object, Bucket=bucket_name, Key=key, Body=data)
                current_update_times.append(time.time() - start_time)
                if i < num_update - 1:
                    time.sleep(update_pause)

        threads = [
            threading.Thread(target=write_objects),
            threading.Thread(target=read_objects),
            threading.Thread(target=update_objects)
        ]

        for t in threads:
            t.start()
        for t in threads:
            t.join()

        max_read_time = max(current_read_times) if current_read_times else 0
        max_write_time = max(current_write_times) if current_write_times else 0
        max_update_time = max(current_update_times) if current_update_times else 0

        max_operation_time = max(max_read_time * num_read, max_write_time * num_write, max_update_time * num_update)

        read_pause = (max_operation_time / num_read) - max_read_time if num_read > 0 else 0
        write_pause = (max_operation_time / num_write) - max_write_time if num_write > 0 else 0
        update_pause = (max_operation_time / num_update) - max_update_time if num_update > 0 else 0

        read_times.extend(current_read_times)
        write_times.extend(current_write_times)
        update_times.extend(current_update_times)

        avg_read = sum(read_times) / len(read_times) if read_times else 0
        avg_write = sum(write_times) / len(write_times) if write_times else 0
        avg_update = sum(update_times) / len(update_times) if update_times else 0

        print(f"–ß—Ç–µ–Ω–∏—è: –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è {avg_read:.4f} —Å–µ–∫, –ü–∞—É–∑–∞ {read_pause:.4f} —Å–µ–∫")
        print(f"–ó–∞–ø–∏—Å–∏: –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è {avg_write:.4f} —Å–µ–∫, –ü–∞—É–∑–∞ {write_pause:.4f} —Å–µ–∫")
        print(f"–û–±–Ω–æ–≤–ª–µ–Ω–∏—è: –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è {avg_update:.4f} —Å–µ–∫, –ü–∞—É–∑–∞ {update_pause:.4f} —Å–µ–∫")

    print("\n–û—á–∏—Å—Ç–∫–∞ –±–∞–∫–µ—Ç–∞...")
    for key in object_keys:
        safe_call(s3.delete_object, Bucket=bucket_name, Key=key)

    safe_call(s3.delete_bucket, Bucket=bucket_name)
    print(f"–ë–∞–∫–µ—Ç {bucket_name} —É–¥–∞–ª—ë–Ω. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã.")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Ceph S3 —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.")
    parser.add_argument("--bucket", required=True, help="–ò–º—è –±–∞–∫–µ—Ç–∞")
    parser.add_argument("--init-objects", type=int, required=True, help="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤")
    parser.add_argument("--size", type=int, required=True, help="–†–∞–∑–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ –≤ –±–∞–π—Ç–∞—Ö")
    parser.add_argument("--read", type=int, required=True, help="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é")
    parser.add_argument("--write", type=int, required=True, help="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é")
    parser.add_argument("--update", type=int, required=True, help="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é")

    args = parser.parse_args()

    s3_test(
        bucket_name=args.bucket,
        num_init_objects=args.init_objects,
        object_size=args.size,
        num_read=args.read,
        num_write=args.write,
        num_update=args.update
    )
–ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–¥?
‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø–∞—É–∑—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
‚úÖ –ü–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –±–µ–∑ –ø–∞—É–∑, –∑–∞—Ç–µ–º –ø–∞—É–∑—ã –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è.
‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏.

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≥—Ä–∞–º–º–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –∏ —Ç–æ—á–Ω–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É. üöÄ
