–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è [Ceph Ansible](https://github.com/ceph/ceph-ansible) –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ Ceph, –≤ —Ç–æ–º —á–∏—Å–ª–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **stretch mode**. –í–æ—Ç –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏:

---

### **1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `ceph-ansible`:**
   ```bash
   git clone https://github.com/ceph/ceph-ansible.git
   cd ceph-ansible
   git checkout stable-6.0  # –í–µ—Ä—Å–∏—è, —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è —Å Quincy (17.x)
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `Ansible` –≤–µ—Ä—Å–∏–∏ 2.9 –∏–ª–∏ –≤—ã—à–µ:
   ```bash
   sudo apt update
   sudo apt install -y ansible
   sudo pip install -r requirements.txt
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –¥–ª—è –≤–∞—à–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞:**
   –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `inventory.yml`):
   ```yaml
   all:
     vars:
       ansible_user: ceph  # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è SSH
       ansible_ssh_private_key_file: /path/to/ssh/key
       ceph_origin: repository
       ceph_repository: community
       ceph_stable_release: quincy
       public_network: <Frontend-—Å–µ—Ç—å>
       cluster_network: <Backend-—Å–µ—Ç—å>
       osd_pool_default_size: 3
       osd_pool_default_min_size: 1
       mon_allow_pool_delete: true
       mon_group: stretch
       ceph_conf_overrides:
         global:
           mon_osd_full_ratio: 0.95
           mon_osd_nearfull_ratio: 0.85
           mon_max_pg_per_osd: 300

     children:
       mons:
         hosts:
           dc1-mon1:
           dc2-mon2:
           dc3-mon3:
       osds:
         hosts:
           dc1-osd1:
           dc1-osd2:
           dc1-osd3:
           dc2-osd4:
           dc3-osd5:
           dc3-osd6:
   ```

---

### **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Stretch Mode**
1. **–û–±–Ω–æ–≤–∏—Ç–µ `group_vars/all.yml`:**
   –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª:
   ```yaml
   stretch_cluster_enabled: true
   crush_rule_config:
     - name: stretch-rule
       type: replicated
       failure_domain: host
       device_class: hdd
       datacenters:
         - name: dc1
           weight: 1
           hosts:
             - dc1-osd1
             - dc1-osd2
             - dc1-osd3
         - name: dc2
           weight: 1
           hosts:
             - dc2-osd4
         - name: dc3
           weight: 1
           hosts:
             - dc3-osd5
             - dc3-osd6
   ```

2. **–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è Stretch Mode:**
   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã CRUSH –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `group_vars/osds.yml`:
   ```yaml
   crush_location:  # –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ OSD
     root: default
     datacenter: "{{ ansible_hostname.split('-')[0] }}"
     host: "{{ inventory_hostname }}"
   ```

---

### **3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É–∑–ª–æ–≤:**
   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —É–∑–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ SSH:
   ```bash
   ansible -i inventory.yml all -m ping
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
   –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–ª–µ–π–±—É–∫ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞:
   ```bash
   ansible-playbook -i inventory.yml site.yml
   ```

---

### **4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞**
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞:**
   ```bash
   ceph status
   ceph osd tree
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ Stretch Mode:**
   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Stretch Mode –≤–∫–ª—é—á–µ–Ω:
   ```bash
   ceph mon dump
   ceph osd crush rule list
   ceph osd crush rule dump stretch-rule
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –¶–û–î:
   ```bash
   rados df
   ceph osd df tree
   ```

---

### **5. –ü–æ—Å—Ç—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**
1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø—É–ª–æ–≤ —Å –ø—Ä–∞–≤–∏–ª–æ–º Stretch:**
   ```bash
   ceph osd pool create stretch-pool 128 128 replicated stretch-rule
   ```

2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   ```bash
   rados -p stretch-pool put testfile /path/to/local/file
   rados -p stretch-pool get testfile /path/to/output/file
   ```

---

### **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**
–ò—Å–ø–æ–ª—å–∑—É—è `ceph-ansible`, –≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Ceph –≤ **Stretch Mode** —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π CRUSH –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∫–≤–æ—Ä—É–º–∞ –º–µ–∂–¥—É –¶–û–î. –≠—Ç–æ –ø–æ–¥—Ö–æ–¥ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ä–∏—Å–∫ –æ—à–∏–±–æ–∫ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–º–æ—â—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏, –¥–∞–π—Ç–µ –∑–Ω–∞—Ç—å! üòä
